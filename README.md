# ESO Logs Build and Buff Summary

A Python tool for analyzing Elder Scrolls Online (ESO) trial logs from [ESO Logs](https://www.esologs.com) to generate detailed build and buff analysis reports.

## üéØ Features

- **Single Report Analysis**: Analyze any ESO Logs report by providing its code
- **Automatic Boss Detection**: Works with any trial - automatically detects boss encounters
- **Multi-Format Output**: Generate reports in Markdown, Discord markup, and PDF formats
- **Comprehensive Build Analysis**: 
  - Player gear sets with proper piece counting (2H weapons = 2 pieces)
  - Arena weapons, mythic items, and monster sets
  - Perfected and non-perfected set merging
- **Intelligent Buff/Debuff Tracking**: 
  - Track important raid buffs and debuffs with uptime percentages
  - Conditional tracking based on equipped gear (Aura of Pride, Tremorscale, Line-Breaker)
  - Oakensoul Ring detection with visual indicators
- **Professional PDF Reports**: 
  - Table of contents with navigation
  - Proper page breaks between encounters
  - Text wrapping in tables
- **Anonymization Support**: 
  - Option to generate anonymized reports with player names replaced by "anon1", "anon2", etc.
  - Removes URLs and identifying information while preserving all gear and buff data
- **Kill/Wipe Status**: Accurate fight outcome detection with boss health percentages

## üìä Example Reports

Here are some example reports generated by the tool to showcase its capabilities:

### Dreadsail Reef Trial (Normal)
- **Report**: [A8TdmkfpP497xvyV](https://www.esologs.com/reports/A8TdmkfpP497xvyV)
- **Description**: Complete trial run with 6 boss encounters including Lylanar and Turlassil, Bow Breaker, Sail Ripper, Reef Guardian, and Tideborn Taleria
- **Features**: Shows typical trial composition with multiple tanks, healers, and DPS players
- **Downloads**: [Markdown](examples/single_report_A8TdmkfpP497xvyV_20250920_1902.md) | [PDF](examples/single_report_A8TdmkfpP497xvyV_20250920_1902.pdf) | [Discord](examples/single_report_A8TdmkfpP497xvyV_20250920_1902_discord.txt)

### vKA Hard Mode Progression
- **Report**: [xbMVztd6Z4CBmFWQ](https://www.esologs.com/reports/xbMVztd6Z4CBmFWQ)
- **Description**: Veteran Kyne's Aegis (vKA) hard mode progression with 5 encounters including Yandir the Butcher, Captain Vrol, and Lord Falgravn
- **Features**: Demonstrates high-end PvE builds with perfected gear sets, arena weapons, and mythic items
- **Downloads**: [Markdown](examples/single_report_xbMVztd6Z4CBmFWQ_20250920_1903.md) | [PDF](examples/single_report_xbMVztd6Z4CBmFWQ_20250920_1903.pdf) | [Discord](examples/single_report_xbMVztd6Z4CBmFWQ_20250920_1903_discord.txt)

### vKA Extended Run
- **Report**: [3gjVGWB2dxCL8XAw](https://www.esologs.com/reports/3gjVGWB2dxCL8XAw)
- **Description**: Extended vKA run with 18 encounters including multiple attempts at various bosses like Jynorah and Skorkhif, Hall of Fleshcraft, and more
- **Features**: Shows repeated encounters and progression attempts with detailed gear analysis across multiple fights
- **Downloads**: [Markdown](examples/single_report_3gjVGWB2dxCL8XAw_20250920_1907.md) | [PDF](examples/single_report_3gjVGWB2dxCL8XAw_20250920_1907.pdf) | [Discord](examples/single_report_3gjVGWB2dxCL8XAw_20250920_1907_discord.txt)

These examples demonstrate the tool's ability to analyze different types of content (normal trials, veteran hard modes, progression runs) and showcase various gear combinations, buff tracking, and comprehensive reporting capabilities.

## üìã Requirements

- Python 3.9+ (for source installation)
- ESO Logs API credentials (Client ID and Secret)
- Internet connection for API access

## üöÄ Installation

### Option 1: Platform-Specific Installers (Recommended)

Download the appropriate installer for your operating system from the [Releases](https://github.com/brainsnorkel/ESO-Log-Build-and-Buff-Summary/releases) page:

#### ü™ü Windows
1. **Download**: Get `ESO-Log-Build-and-Buff-Summary-Installer.exe` from the latest release
2. **Install**: Run the installer as administrator
3. **Configure**: Set up your ESO Logs API credentials (see below)
4. **Use**: Open Command Prompt and run `ESO-Log-Build-and-Buff-Summary.exe --help`

#### üçé macOS
1. **Download**: Get `ESO-Log-Build-and-Buff-Summary-macOS-*.dmg` from the latest release
2. **Install**: Mount the DMG and drag the app to Applications folder
3. **Configure**: Set up your ESO Logs API credentials (see below)
4. **Use**: Run from Applications or Terminal

#### üêß Linux
1. **Download**: Get `ESO-Log-Build-and-Buff-Summary-Linux-*.AppImage` from the latest release
2. **Install**: Make executable (`chmod +x`) and run directly
3. **Configure**: Set up your ESO Logs API credentials (see below)
4. **Use**: Run from terminal or double-click the AppImage

### Option 2: Portable Versions

For users who prefer not to install:
1. **Download**: Get the portable version for your platform from the latest release
2. **Run**: Execute the file directly - no installation required
3. **Configure**: Set up your ESO Logs API credentials (see below)

### Option 3: Source Installation

1. **Clone the repository:**
```bash
git clone https://github.com/brainsnorkel/ESO-Logs-Build-and-Buff-Summary.git
cd ESO-Logs-Build-and-Buff-Summary
```

2. **Create and activate a virtual environment:**
```bash
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. **Install dependencies:**
```bash
pip install -r requirements.txt
```

4. **Set up API credentials:**
   - Go to [ESO Logs API](https://www.esologs.com/api/clients/) and create a new client
   - Create a `.env` file in the project root:
```bash
ESOLOGS_ID=your_client_id_here
ESOLOGS_SECRET=your_client_secret_here
```

## üîë API Credentials Setup

For all installation methods, you need ESO Logs API credentials:

1. **Get API Credentials:**
   - Visit [ESO Logs API](https://www.esologs.com/api/clients/)
   - Create a new API client
   - Copy your Client ID and Secret

2. **Configure Credentials:**
   - **Windows Installer**: Edit the `.env` file in `%APPDATA%\ESO-Log-Build-and-Buff-Summary\`
   - **macOS DMG**: Edit the `.env` file in `~/Library/Application Support/ESO-Log-Build-and-Buff-Summary/`
   - **Linux AppImage**: Create a `.env` file in `~/.config/ESO-Log-Build-and-Buff-Summary/`
   - **Portable Versions**: Create a `.env` file in the same directory as the executable
   - **Source Installation**: Create a `.env` file in the project root

3. **Environment Variables:**
```bash
ESOLOGS_ID=your_client_id_here
ESOLOGS_SECRET=your_client_secret_here
```

## üìñ Usage

### Basic Usage

Analyze a single ESO Logs report:

```bash
python single_report_tool.py <report_code>
```

**Examples:**
```bash
# Using report ID
python single_report_tool.py 3gjVGWB2dxCL8XAw

# Using full URL (automatically extracts report ID)
python single_report_tool.py "https://www.esologs.com/reports/3gjVGWB2dxCL8XAw"
```

### Output Formats

Choose your preferred output format:

```bash
# Console output only (default) - using report ID
python single_report_tool.py 3gjVGWB2dxCL8XAw

# Console output only (default) - using full URL
python single_report_tool.py "https://www.esologs.com/reports/3gjVGWB2dxCL8XAw"

# Generate Markdown report
python single_report_tool.py 3gjVGWB2dxCL8XAw --output markdown

# Generate Discord report
python single_report_tool.py 3gjVGWB2dxCL8XAw --output discord

# Generate PDF report
python single_report_tool.py 3gjVGWB2dxCL8XAw --output pdf

# Generate all formats
python single_report_tool.py 3gjVGWB2dxCL8XAw --output all
```

### Advanced Options

```bash
# Specify output directory
python single_report_tool.py 3gjVGWB2dxCL8XAw --output all --output-dir my_reports

# Enable verbose logging
python single_report_tool.py 3gjVGWB2dxCL8XAw --verbose

# Generate anonymized reports (removes player names, URLs, etc.)
python single_report_tool.py 3gjVGWB2dxCL8XAw --output all --anonymize
```

### Complete Command Reference

```bash
python single_report_tool.py <report_code> [options]

Arguments:
  report_code           ESO Logs report code or full URL (e.g., 3gjVGWB2dxCL8XAw or https://www.esologs.com/reports/3gjVGWB2dxCL8XAw)

Options:
  --output {console,markdown,discord,pdf,all}
                        Output format (default: console)
  --output-dir DIR      Directory for output files (default: reports)
  --anonymize           Anonymize reports by replacing player names with anon1, anon2, etc.
  --verbose, -v         Enable verbose logging
  --help, -h           Show help message
```

## üîç Finding Report Codes

ESO Logs report codes can be found in the URL of any log:

**Example URL:** `https://www.esologs.com/reports/3gjVGWB2dxCL8XAw`
**Report Code:** `3gjVGWB2dxCL8XAw`

## üìä Report Contents

### What's Analyzed

- **All Boss Encounters**: Automatically detects boss fights in any trial
- **Player Builds**: Complete gear analysis for all 12 players (2 tanks, 2 healers, 8 DPS)
- **Gear Sets**: 
  - Regular sets with proper piece counting
  - Arena weapons (Maelstrom, Master's, etc.)
  - Mythic items (Oakensoul, Velothi Ur-Mage's Amulet, etc.)
  - Monster sets (1-piece and 2-piece)
- **Buff/Debuff Uptimes**: Comprehensive tracking with intelligent detection and calculation logic

### Report Formats

#### üìù Markdown (.md)
- Clean, readable format for sharing and documentation
- Tables for player builds
- Buff/debuff uptime tables
- Kill/wipe status with boss percentages

#### üí¨ Discord (.txt)
- Optimized for Discord chat sharing
- Bold formatting for emphasis
- Compact layout for mobile viewing

#### üìÑ PDF (.pdf)
- Professional document format
- **Linked Table of Contents** for easy navigation
- Each encounter on separate page
- Text wrapping in tables
- **Table headings stay with their tables** (no orphaned headers)
- Proper page break control

## üìä Buff and Debuff Tracking Logic

The tool uses intelligent detection and calculation logic for buff and debuff uptimes. Here's how it works:

### üü¢ Buff Tracking

#### **Standard Buffs (Always Tracked)**
- **Major Courage** - Damage buff for group
- **Major Slayer** - Damage buff for group  
- **Major Berserk** - Damage buff for group
- **Major Force** - Damage buff for group
- **Minor Toughness** - Health buff for group
- **Major Resolve** - Damage mitigation buff for group
- **Powerful Assault** - Damage buff for group

#### **Conditional Buffs (Tracked Only When Present)**
- **Aura of Pride** - Only shown when a player is wearing **Spaulder of Ruin**

#### **Special Calculation Rules**

**Powerful Assault:**
- **Specific Ability ID**: Only uses uptime from ability ID `61771` (the main Powerful Assault buff)
- **Ignores Other Variations**: Skips other Powerful Assault ability IDs to avoid double-counting
- **Fallback**: If ability ID 61771 is not found, uses the highest uptime among all variations

**Oakensoul Ring Detection:**
- When any player in the group has **Oakensoul Ring** equipped:
  - **Major Courage** and **Major Resolve** percentages show an asterisk (*)
  - The asterisk indicates these values may be inflated due to Oakensoul's passive nature

**All Other Buffs:**
- **Largest Percentage Method**: Finds the highest uptime among all variations of each named effect
- **Multiple Ability IDs**: Each buff can have multiple ability IDs (different sources/spells)
- **Variation Handling**: Handles different naming conventions (spaces, hyphens, capitalization)

### üî¥ Debuff Tracking

#### **Standard Debuffs (Always Tracked)**
- **Major Breach** - Armor reduction on enemies
- **Major Vulnerability** - Damage taken increase on enemies
- **Minor Brittle** - Critical damage increase on enemies
- **Stagger** - Damage over time debuff
- **Crusher** - Armor reduction from weapon enchantments
- **Off Balance** - Damage increase on enemies
- **Weakening** - Damage reduction on enemies

#### **Conditional Debuffs (Tracked Only When Present)**
- **Tremorscale** - Only shown when a player is wearing **2pc Tremorscale**
- **Line-Breaker** - Only shown when a player is wearing **5pc Alkosh**
- **Runic Sunder** - Only shown when it appears in the fight's debuff list

#### **Special Calculation Rules**

**Major Vulnerability:**
- **Largest Percentage Method**: Uses the **highest percentage** from all variations found
- **Multiple Ability IDs**: Handles multiple sources (different ability IDs) correctly
- **Variation Aggregation**: Combines all Major Vulnerability variations and takes the highest

**All Other Debuffs:**
- **Largest Percentage Method**: Finds the **highest percentage** among all variations of each named effect
- **Multiple Ability IDs**: Each debuff can have multiple ability IDs (different sources/spells)
- **Variation Handling**: Handles different naming conventions (spaces, hyphens, capitalization)
- **Prevents Double-Counting**: Avoids counting similar effects multiple times

### üéØ Detection Logic

#### **Gear-Based Detection**
The tool scans all player gear sets to detect:
- **Spaulder of Ruin** ‚Üí Enables "Aura of Pride" buff tracking
- **2pc Tremorscale** ‚Üí Enables "Tremorscale" debuff tracking  
- **5pc Alkosh** ‚Üí Enables "Line-Breaker" debuff tracking
- **Oakensoul Ring** ‚Üí Adds asterisk (*) to Major Courage and Major Resolve

#### **API-Based Detection**
- **Runic Sunder** ‚Üí Detected from the fight's debuff list in ESO Logs data
- **All other buffs/debuffs** ‚Üí Detected from ESO Logs buff/debuff tables

### üìà Uptime Calculation

1. **Data Source**: ESO Logs buff/debuff table API
2. **Calculation**: `(total_uptime_ms / fight_duration_ms) √ó 100`
3. **Aggregation Methods**:
   - **Specific Ability ID**: Powerful Assault uses only ability ID `61771`
   - **Largest Percentage**: Most buffs/debuffs use the highest uptime among all variations
   - **Summation**: Off Balance may sum multiple sources (if applicable)
4. **Ability ID Tracking**: Each effect can have multiple ability IDs representing different sources:
   - **Multiple Spells**: Same effect from different abilities (e.g., Major Courage from different sources)
   - **Different Sources**: Same effect from different players or gear sets
   - **Variation Handling**: Combines all variations and selects the highest percentage

### ‚ö†Ô∏è Important Notes

- **Asterisk (*)**: Indicates buffs that may be inflated due to Oakensoul Ring passive effects
- **0.0% Values**: May indicate the effect wasn't present or detected in the fight
- **Conditional Effects**: Only appear when the required gear/conditions are met
- **Accuracy**: Uptime percentages reflect actual in-combat uptime, not theoretical maximums

## üé≠ Class Name Mapping

The tool automatically maps ESO class names to shorter, more readable formats:

| ESO Class | Display Name |
|-----------|--------------|
| Arcanist | Arc |
| Sorcerer | Sorc |
| DragonKnight | DK |
| Necromancer | Cro |
| Templar | Plar |
| Warden | Den |
| Nightblade | NB |

**Special Prefixes:**
- **Oaken Prefix**: When a player has **Oakensoul Ring** equipped, their class name gets an "Oaken" prefix (e.g., "OakenSorc", "OakenDK")

## üèóÔ∏è Project Structure

```
ESO-Logs-Build-and-Buff-Summary/
‚îú‚îÄ‚îÄ src/eso_builds/           # Main package
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py         # ESO Logs API client
‚îÇ   ‚îú‚îÄ‚îÄ models.py             # Data models
‚îÇ   ‚îú‚îÄ‚îÄ gear_parser.py        # Gear set detection logic
‚îÇ   ‚îú‚îÄ‚îÄ markdown_formatter.py # Markdown report formatter
‚îÇ   ‚îú‚îÄ‚îÄ discord_formatter.py  # Discord report formatter
‚îÇ   ‚îú‚îÄ‚îÄ pdf_formatter.py      # PDF report formatter
‚îÇ   ‚îî‚îÄ‚îÄ single_report_analyzer.py # Single report analysis
‚îú‚îÄ‚îÄ single_report_tool.py     # CLI tool
‚îú‚îÄ‚îÄ requirements.txt          # Python dependencies
‚îú‚îÄ‚îÄ .env                      # API credentials (create this)
‚îî‚îÄ‚îÄ reports/                  # Generated reports (auto-created)
```

## üõ†Ô∏è Development

### Running Tests

```bash
# Install development dependencies
pip install -r requirements-dev.txt

# Run tests
python -m pytest tests/

# Run with coverage
python -m pytest tests/ --cov=src
```

### Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature-name`
3. Make your changes
4. Add tests for new functionality
5. Run the test suite
6. Commit your changes: `git commit -m "Add feature"`
7. Push to your branch: `git push origin feature-name`
8. Create a Pull Request

## üìù Example Output

### Console Output
```
üîç Analyzing ESO Logs Report: 3gjVGWB2dxCL8XAw
==================================================
‚úÖ Found 18 encounters
  ‚Ä¢ Red Witch Gedna Relvel (Veteran)
    Players: 2 tanks, 1 healers, 9 dps
  ‚Ä¢ Hall of Fleshcraft (Veteran Hard Mode)
    Players: 2 tanks, 2 healers, 9 dps
  ...

üìÑ PDF report saved to: reports/single_report_3gjVGWB2dxCL8XAw_20250920_1243.pdf
```

### Generated Files
- `single_report_3gjVGWB2dxCL8XAw_20250920_1243.md` - Markdown format
- `single_report_3gjVGWB2dxCL8XAw_20250920_1243_discord.txt` - Discord format  
- `single_report_3gjVGWB2dxCL8XAw_20250920_1243.pdf` - PDF format with TOC

## üîß Troubleshooting

### Common Issues

**"No module named 'esologs'"**
- Make sure you've activated your virtual environment and installed requirements

**"API authentication failed"**
- Check your `.env` file has the correct CLIENT_ID and CLIENT_SECRET
- Verify your ESO Logs API client is active

**"No encounter data found"**
- Verify the report code is correct
- Some very old reports may not have complete data
- Private reports may not be accessible

**"HTTP 429 - Rate Limited"**
- The tool respects ESO Logs rate limits
- Wait a few minutes and try again

**"Missing Expected Buffs/Debuffs"**
- **Conditional Effects**: Some buffs/debuffs only appear when specific gear is worn:
  - Aura of Pride requires Spaulder of Ruin
  - Tremorscale requires 2pc+ Tremorscale
  - Line-Breaker requires 5pc+ Alkosh
- **0.0% Values**: May indicate the effect wasn't present or detected in the fight
- **Gear Detection**: Verify players are wearing the expected gear sets

### Getting Help

- Check the [Issues](https://github.com/brainsnorkel/ESO-Logs-Build-and-Buff-Summary/issues) page
- Create a new issue with:
  - Your Python version
  - Complete error message
  - Report code you're trying to analyze
  - Steps to reproduce

## üìú License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- [ESO Logs](https://www.esologs.com) for providing the API and data
- [esologs-python](https://github.com/Dreemurro/esologs-python) library for API access
- The Elder Scrolls Online community for testing and feedback

## üîó Links

- [ESO Logs](https://www.esologs.com)
- [ESO Logs API Documentation](https://www.esologs.com/v2-api-docs/eso/)
- [Elder Scrolls Online](https://www.elderscrollsonline.com/)

---

**Made with ‚ù§Ô∏è for the ESO community**
